package application;

import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;
import javafx.scene.media.MediaPlayer.Status;

import java.io.*;
import java.util.*;

public class Alice {
	LinkedList<File> queue;
	MediaPlayer alice;
	
	boolean loop;
	boolean pause;
	
	/**
	 * Loop the file that are playing
	 * If no file is playing, the method will return 
	 */
	void loop() {
		if(alice.getStatus() == Status.STOPPED) {
			return;
		}
		
		if(loop) {
			alice.setCycleCount(1);
		}else {
			alice.setCycleCount(MediaPlayer.INDEFINITE);
		}
		loop = !loop;
	}
	
	/**
	* play the next file
	* Although it is call "skip," 
	* it should be better named as "play next"
	*/
	void skip() {
		if(queue.size() >= 1) {
			alice = new MediaPlayer(new Media(queue.removeFirst().toURI().toString()));
			alice.play();
			alice.setOnEndOfMedia(new Runnable() {
				@Override
				public void run() {
					alice.stop();
					if(!queue.isEmpty()) {
						skip();
					}
				}
				
			});
		}
	}
	
	void clear() {
		queue = new LinkedList<File>();
	}
	
	void add(File f) {
		queue.addLast(f);
	}
	
	void insert(File f) {
		queue.addFirst(f);
	}
	
	void play() {
		 Status cur = alice.getStatus();
		 if(cur == Status.PAUSED) {
			 alice.play();
			 pause = false;
		 }else if(cur == Status.PLAYING){
			 alice.pause();
			 pause = true;
		 }else if(cur == Status.STOPPED) {
			 skip();
			 pause = false;
		 }
	}
	
	public Alice() {
		queue = new LinkedList<File>();
		alice = new MediaPlayer(new Media("http://www.sovmusic.ru/sam/s12264.mp3"));
		
		loop = false;
		pause = true;
	}
}
